FROM node:20-alpine

WORKDIR /app

# Install pnpm
RUN npm install -g pnpm@10.13.1

# Copy entrypoint script
COPY docker-entrypoint.sh /usr/local/bin/
RUN chmod +x /usr/local/bin/docker-entrypoint.sh

ENTRYPOINT ["docker-entrypoint.sh"]

# Copy only root config files - source code comes via volumes
# This keeps the image small and export fast
COPY package.json pnpm-lock.yaml pnpm-workspace.yaml turbo.json ./

# Note: Dependencies are installed on first container run via entrypoint script
# This avoids huge layer exports during build. Volumes mount source code,
# and entrypoint ensures deps are installed before running commands.

